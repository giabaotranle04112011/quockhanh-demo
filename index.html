<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Kỷ niệm 80 năm Quốc Khánh Việt Nam 2/9 (1945–2025) - Tự hào dân tộc, vững bước tương lai">
  <meta property="og:title" content="Kỷ Niệm 80 Năm Quốc Khánh 2/9">
  <meta property="og:description" content="Chào mừng 80 năm Ngày Độc lập Việt Nam. Gửi lời chúc, xem ảnh lịch sử và lan tỏa tinh thần yêu nước!">
  <meta property="og:image" content="https://upload.wikimedia.org/wikipedia/commons/2/21/Flag_of_Vietnam.svg">
  <meta property="og:url" content="https://yourwebsite.com">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; img-src 'self' https://upload.wikimedia.org; script-src 'self' https://cdn.jsdelivr.net https://unpkg.com 'unsafe-inline'; style-src 'self' https://unpkg.com 'unsafe-inline'; media-src 'self' https://upload.wikimedia.org; connect-src 'self' https://yourwebsite.com;">
  <title>Kỷ Niệm 80 Năm Quốc Khánh 2/9 (1945–2025)</title>
  <link rel="stylesheet" href="https://unpkg.com/aos@2.3.1/dist/aos.css">
  <link rel="manifest" href="/manifest.json">
  <link rel="icon" href="https://upload.wikimedia.org/wikipedia/commons/2/21/Flag_of_Vietnam.svg" type="image/svg+xml">
  <style>
    :root {
      --bg1: #a30000;
      --bg2: #330000;
      --text: #ffffff;
      --muted: #bbbbbb;
      --accent: #ffcc00;
      --bg-light: #f5f5f5;
      --text-light: #333;
      --shadow: 0 4px 12px rgba(0,0,0,0.3);
    }
    *, *::before, *::after { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, Arial, sans-serif;
      background: linear-gradient(to bottom, var(--bg1), var(--bg2));
      color: var(--text);
      overflow-x: hidden;
      scroll-behavior: smooth;
      -webkit-font-smoothing: antialiased;
    }
    body.light-mode {
      background: var(--bg-light);
      color: var(--text-light);
    }
    body.light-mode nav { background: rgba(255,255,255,0.95); }
    body.light-mode nav a { color: var(--bg1); }
    body.light-mode nav a:hover, body.light-mode nav a.active { color: var(--accent); }
    body.light-mode .msg { background: rgba(0,0,0,0.05); }
    body.light-mode section { background: rgba(255,255,255,0.98); }
    #loading-screen {
      position: fixed;
      inset: 0;
      background: #000;
      display: grid;
      place-items: center;
      z-index: 2000;
      opacity: 1;
      transition: opacity 0.8s ease-out;
    }
    #loading-screen.hidden { opacity: 0; pointer-events: none; }
    #loading-screen img {
      width: clamp(100px, 25vw, 120px);
      animation: flagWave 2.5s ease-in-out infinite;
    }
    @keyframes flagWave {
      0%, 100% { transform: scale(1) rotate(0deg); }
      50% { transform: scale(1.08) rotate(3deg); }
    }
    nav {
      position: sticky;
      top: 0;
      width: 100%;
      background: rgba(0,0,0,0.75);
      backdrop-filter: blur(8px);
      display: flex;
      justify-content: center;
      gap: clamp(6px, 1.5vw, 8px);
      padding: clamp(6px, 1.5vw, 8px);
      z-index: 100;
      flex-wrap: wrap;
    }
    nav a {
      color: var(--accent);
      text-decoration: none;
      font-weight: 600;
      padding: clamp(6px, 1.5vw, 8px) clamp(8px, 2vw, 10px);
      font-size: clamp(13px, 2.2vw, 15px);
      border-radius: 6px;
      transition: color 0.2s, background 0.2s, transform 0.2s;
      min-width: 44px;
      min-height: 44px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }
    nav a:hover, nav a.active {
      color: #fff;
      background: rgba(255,255,255,0.15);
      transform: scale(1.03);
    }
    header {
      text-align: center;
      padding: clamp(60px, 15vw, 100px) 10px clamp(40px, 10vw, 60px);
      background: url('https://upload.wikimedia.org/wikipedia/commons/2/21/Flag_of_Vietnam.svg') center/cover fixed;
      color: white;
      position: relative;
      min-height: 70vh;
      display: grid;
      place-content: center;
    }
    header::after {
      content: "";
      position: absolute;
      inset: 0;
      background: rgba(0,0,0,0.6);
    }
    header h1, header p, header #countdown { position: relative; z-index: 1; }
    header h1 {
      font-size: clamp(1.8em, 4.5vw, 2.8em);
      margin: 0;
      color: var(--accent);
      text-shadow: var(--shadow);
      transition: transform 0.3s ease;
    }
    header h1:hover { transform: scale(1.03); }
    #countdown {
      font-size: clamp(0.85em, 2.2vw, 1.1em);
      margin-top: 12px;
      color: var(--muted);
    }
    section {
      padding: clamp(20px, 6vw, 40px) 10px;
      max-width: 1100px;
      margin: auto;
      transition: transform 0.2s;
    }
    section:hover { transform: translateY(-3px); }
    h2 {
      border-left: 5px solid var(--accent);
      padding-left: 12px;
      margin-bottom: 15px;
      font-size: clamp(1.3em, 3.2vw, 1.6em);
    }
    .timeline {
      position: relative;
      margin-left: 20px;
      list-style: none;
      padding-left: 20px;
    }
    .timeline::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      width: 3px;
      height: 100%;
      background: var(--accent);
    }
    .timeline li {
      margin: 15px 0;
      padding: 12px 15px;
      background: rgba(255,255,255,0.1);
      border-radius: 6px;
      position: relative;
      transition: transform 0.2s, background 0.2s;
      font-size: clamp(0.85em, 2.2vw, 0.95em);
    }
    .timeline li:hover {
      transform: scale(1.01);
      background: rgba(255,255,255,0.2);
    }
    .timeline li::before {
      content: "★";
      position: absolute;
      left: -30px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--accent);
      font-size: 0.9em;
      transition: transform 0.2s;
    }
    .timeline li:hover::before { transform: translateY(-50%) scale(1.15); }
    .timeline strong { color: var(--accent); }
    .gallery {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(clamp(130px, 40vw, 160px), 1fr));
      gap: 10px;
    }
    .gallery figure { margin: 0; }
    .gallery img {
      width: 100%;
      border-radius: 6px;
      box-shadow: var(--shadow);
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      object-fit: cover;
      aspect-ratio: 4/3;
    }
    .gallery img:hover { transform: scale(1.05); box-shadow: 0 0 15px rgba(255,204,0,0.5); }
    .gallery figcaption {
      margin-top: 4px;
      text-align: center;
      font-size: clamp(0.75em, 2.2vw, 0.9em);
      color: var(--muted);
    }
    .gallery-filter {
      margin-bottom: 12px;
      display: flex;
      gap: 6px;
      justify-content: center;
      flex-wrap: wrap;
    }
    .gallery-filter button {
      padding: 6px 10px;
      border: none;
      border-radius: 6px;
      background: var(--accent);
      cursor: pointer;
      font-size: clamp(12px, 2.2vw, 14px);
      min-width: 44px;
      min-height: 44px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      transition: transform 0.2s, background 0.2s;
    }
    .gallery-filter button:hover, .gallery-filter button.active {
      background: #fff;
      color: #000;
      transform: scale(1.03);
    }
    #modal {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.85);
      justify-content: center;
      align-items: center;
      z-index: 1000;
      flex-direction: column;
    }
    #modal img {
      max-width: 90%;
      max-height: 65%;
      border-radius: 6px;
      box-shadow: var(--shadow);
      transform: scale(0.9);
      transition: transform 0.3s ease;
      object-fit: contain;
    }
    #modal.show img { transform: scale(1); }
    #modal figcaption {
      color: var(--muted);
      margin-top: 6px;
      font-size: clamp(0.85em, 2.2vw, 0.95em);
    }
    .modal-controls { margin-top: 10px; display: flex; gap: 10px; }
    .modal-controls button {
      padding: 6px 10px;
      border: none;
      border-radius: 6px;
      background: var(--accent);
      cursor: pointer;
      font-size: clamp(12px, 2.2vw, 14px);
      min-width: 44px;
      min-height: 44px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      transition: transform 0.2s;
    }
    .modal-controls button:hover { transform: scale(1.08); }
    .modal-controls svg { width: 16px; height: 16px; }
    #wall {
      display: grid;
      gap: 8px;
      margin-top: 12px;
    }
    .msg {
      padding: 8px;
      background: rgba(255,255,255,0.12);
      border-radius: 6px;
      display: flex;
      align-items: flex-start;
      gap: 6px;
      transition: transform 0.2s, box-shadow 0.2s;
      font-size: clamp(0.85em, 2.2vw, 0.95em);
    }
    .msg:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow);
    }
    .msg .avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: var(--accent);
      display: grid;
      place-items: center;
      font-size: 0.9em;
    }
    .msg .content { flex: 1; }
    .msg .share-btn, .msg .like-btn {
      background: var(--accent);
      border: none;
      border-radius: 6px;
      padding: 5px 8px;
      cursor: pointer;
      font-size: clamp(0.8em, 2.2vw, 0.9em);
      min-width: 44px;
      min-height: 44px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      transition: transform 0.2s;
    }
    .msg .share-btn:hover, .msg .like-btn:hover { transform: scale(1.08); }
    .msg .like-btn { margin-left: 6px; }
    .msg .like-btn.liked { background: #ff4444; }
    .msg small { display: block; color: var(--muted); font-size: 0.7em; margin-top: 3px; }
    .pagination {
      margin-top: 12px;
      display: flex;
      justify-content: center;
      gap: 6px;
      flex-wrap: wrap;
    }
    .pagination button {
      padding: 6px 10px;
      border: none;
      border-radius: 6px;
      background: var(--accent);
      cursor: pointer;
      font-size: clamp(12px, 2.2vw, 14px);
      min-width: 44px;
      min-height: 44px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      transition: transform 0.2s;
    }
    .pagination button:hover, .pagination button.active { transform: scale(1.03); }
    #msgChart { margin-top: 12px; width: 100%; height: 220px; }
    footer {
      text-align: center;
      padding: 12px;
      font-size: clamp(0.85em, 2.2vw, 0.95em);
      color: var(--accent);
      background: #111;
    }
    footer .marquee {
      display: inline-block;
      white-space: nowrap;
      animation: marquee 12s linear infinite;
    }
    @keyframes marquee { from { transform: translateX(100%); } to { transform: translateX(-100%); } }
    canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; pointer-events: none; }
    #musicControl, #themeToggle, #scrollTop {
      position: fixed;
      padding: 6px 10px;
      border: none;
      border-radius: 6px;
      background: var(--accent);
      cursor: pointer;
      color: #fff;
      font-size: clamp(12px, 2.2vw, 14px);
      min-width: 44px;
      min-height: 44px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      transition: transform 0.2s;
    }
    #musicControl:hover, #themeToggle:hover, #scrollTop:hover { transform: scale(1.08); }
    #musicControl { top: 50px; right: 10px; }
    #themeToggle { top: 100px; right: 10px; }
    #scrollTop { bottom: 10px; right: 10px; border-radius: 50%; display: none; }
    #musicSelect {
      position: fixed;
      top: 150px;
      right: 10px;
      padding: 6px;
      border-radius: 6px;
      background: var(--accent);
      color: #fff;
      font-size: clamp(12px, 2.2vw, 14px);
      min-width: 44px;
      min-height: 44px;
      transition: transform 0.2s;
    }
    #musicSelect:hover { transform: scale(1.03); }
    #searchInput, #nameInput, #msgInput, #emojiInput {
      padding: 6px;
      border-radius: 6px;
      border: none;
      font-size: clamp(12px, 2.2vw, 14px);
      margin: 4px;
      width: 100%;
      box-sizing: border-box;
      transition: box-shadow 0.2s;
    }
    #searchInput:focus, #nameInput:focus, #msgInput:focus, #emojiInput:focus {
      box-shadow: 0 0 6px var(--accent);
      outline: none;
    }
    #msgForm {
      display: flex;
      flex-direction: column;
      gap: 6px;
      padding: 8px;
    }
    #msgForm button {
      padding: 6px 12px;
      background: var(--accent);
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: clamp(12px, 2.2vw, 14px);
      min-width: 80px;
      min-height: 44px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      transition: transform 0.2s;
    }
    #msgForm button:hover { transform: scale(1.03); }
    #exportBtn, #chartFilter {
      padding: 6px 10px;
      border: none;
      border-radius: 6px;
      background: var(--accent);
      cursor: pointer;
      font-size: clamp(12px, 2.2vw, 14px);
      margin: 6px;
      min-width: 44px;
      min-height: 44px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      transition: transform 0.2s;
    }
    #exportBtn:hover, #chartFilter:hover { transform: scale(1.03); }
    #leaderboard {
      margin-top: 12px;
      padding: 10px;
      background: rgba(255,255,255,0.12);
      border-radius: 6px;
      transition: transform 0.2s;
      font-size: clamp(0.85em, 2.2vw, 0.95em);
    }
    #leaderboard:hover { transform: translateY(-2px); }
    #leaderboard ol { padding-left: 12px; }
    #leaderboard li { margin: 4px 0; }
    @media (max-width: 600px) {
      header { padding: 50px 6px 30px; }
      nav { gap: 6px; padding: 5px; }
      section { padding: 20px 6px; }
      .gallery { grid-template-columns: repeat(auto-fit, minmax(110px, 1fr)); }
      #msgForm input, #msgForm select { width: 100%; }
      #msgForm button { width: 100%; }
      #musicControl, #themeToggle, #musicSelect { right: 8px; }
      #scrollTop { bottom: 8px; right: 8px; }
      .modal-controls button { padding: 5px 8px; }
      .msg { padding: 6px; gap: 5px; }
      .msg .avatar { width: 28px; height: 28px; font-size: 0.85em; }
      .pagination button { padding: 5px 8px; }
      #msgChart { height: 180px; }
    }
    @media (prefers-reduced-motion: reduce) {
      * { animation: none !important; transition: none !important; }
    }
  </style>
</head>
<body>
  <div id="loading-screen" role="status" aria-live="polite">
    <img src="https://upload.wikimedia.org/wikipedia/commons/2/21/Flag_of_Vietnam.svg" alt="Cờ Việt Nam" loading="eager">
  </div>
  <nav role="navigation" aria-label="Điều hướng chính">
    <a href="#ynghia" aria-label="Ý nghĩa ngày 2/9">Ý nghĩa</a>
    <a href="#hanhtrinh" aria-label="Hành trình 80 năm">Hành trình</a>
    <a href="#anh" aria-label="Thư viện ảnh">Thư viện ảnh</a>
    <a href="#loichuc" aria-label="Tường lời chúc">Lời chúc</a>
  </nav>
  <canvas id="fireworks" aria-hidden="true"></canvas>
  <button id="musicControl" aria-label="Phát hoặc dừng nhạc nền">🔊</button>
  <button id="themeToggle" aria-label="Chuyển đổi chế độ sáng tối">🌙</button>
  <select id="musicSelect" aria-label="Chọn bài nhạc nền">
    <option value="https://upload.wikimedia.org/wikipedia/commons/0/05/Nhac_quoc_ca_Viet_Nam.ogg">Quốc ca Việt Nam</option>
  </select>
  <button id="scrollTop" aria-label="Cuộn lên đầu trang">⬆</button>
  <audio id="anthem" preload="auto" aria-hidden="true"></audio>
  <audio id="clickSound" src="data:audio/mpeg;base64,/+MYxAAAAANIAAAAAExBTUUzLjEwMC4y/+MYxDsAAABlAAAAABN3V1gAAOw==" aria-hidden="true"></audio>

  <header data-aos="fade-up" aria-label="Tiêu đề chính kỷ niệm 80 năm Quốc Khánh">
    <h1 data-aos="zoom-in">Kỷ Niệm 80 Năm Quốc Khánh 2/9</h1>
    <p data-aos="fade-up" data-aos-delay="200">1945 – 2025</p>
    <p data-aos="fade-up" data-aos-delay="400">Chào mừng 80 năm Ngày Độc lập Việt Nam 🇻🇳</p>
    <div id="countdown" data-aos="fade-up" data-aos-delay="600" aria-live="polite"></div>
  </header>

  <section id="ynghia" data-aos="fade-up" aria-labelledby="ynghia-title">
    <h2 id="ynghia-title">Ý nghĩa ngày 2/9</h2>
    <p>Ngày 2/9/1945, tại Quảng trường Ba Đình, Chủ tịch Hồ Chí Minh đọc Tuyên ngôn Độc lập, khai sinh nước Việt Nam Dân chủ Cộng hòa, mở ra kỷ nguyên độc lập, tự do.</p>
  </section>

  <section id="hanhtrinh" data-aos="fade-up" aria-labelledby="hanhtrinh-title">
    <h2 id="hanhtrinh-title">Hành trình 80 năm</h2>
    <ul class="timeline" data-aos="fade-up" data-aos-delay="200" aria-label="Dòng thời gian lịch sử">
      <li><strong>1945</strong> — Tuyên ngôn Độc lập</li>
      <li><strong>1946</strong> — Hiến pháp đầu tiên</li>
      <li><strong>1954</strong> — Chiến thắng Điện Biên Phủ</li>
      <li><strong>1975</strong> — Giải phóng miền Nam, thống nhất đất nước</li>
      <li><strong>1986</strong> — Công cuộc Đổi mới</li>
      <li><strong>1995</strong> — Việt Nam gia nhập ASEAN</li>
      <li><strong>2025</strong> — 80 năm độc lập, tự cường, phát triển</li>
    </ul>
  </section>

  <section id="anh" data-aos="fade-up" aria-labelledby="anh-title">
    <h2 id="anh-title">Thư viện ảnh</h2>
    <div class="gallery-filter" role="tablist">
      <button data-filter="all" class="active" role="tab" aria-selected="true" aria-label="Hiển thị tất cả ảnh">Tất cả</button>
      <button data-filter="history" role="tab" aria-selected="false" aria-label="Hiển thị ảnh lịch sử">Lịch sử</button>
      <button data-filter="flag" role="tab" aria-selected="false" aria-label="Hiển thị ảnh quốc kỳ">Quốc kỳ</button>
    </div>
    <div class="gallery" role="region" aria-label="Thư viện ảnh Quốc Khánh">
      <figure data-category="history">
        <img data-src="https://upload.wikimedia.org/wikipedia/commons/2/2e/Quang_Trung_Ba_Dinh_1945.jpg" alt="Quảng trường Ba Đình 1945" loading="lazy">
        <figcaption>Quảng trường Ba Đình 1945</figcaption>
      </figure>
      <figure data-category="history">
        <img data-src="https://upload.wikimedia.org/wikipedia/commons/5/5b/Ho_Chi_Minh_1945.jpg" alt="Hồ Chí Minh đọc Tuyên ngôn" loading="lazy">
        <figcaption>Bác Hồ đọc Tuyên ngôn Độc lập</figcaption>
      </figure>
      <figure data-category="flag">
        <img data-src="https://upload.wikimedia.org/wikipedia/commons/2/21/Flag_of_Vietnam.svg" alt="Quốc kỳ" loading="lazy">
        <figcaption>Quốc kỳ Việt Nam</figcaption>
      </figure>
    </div>
  </section>

  <div id="modal" role="dialog" aria-label="Xem ảnh lớn" tabindex="-1">
    <img src="" alt="" aria-label="Ảnh trong thư viện">
    <figcaption></figcaption>
    <div class="modal-controls" role="toolbar">
      <button id="prev" aria-label="Ảnh trước">
        <svg viewBox="0 0 24 24"><path d="M15 18l-6-6 6-6"/></svg>
      </button>
      <button id="next" aria-label="Ảnh tiếp theo">
        <svg viewBox="0 0 24 24"><path d="M9 18l6-6-6-6"/></svg>
      </button>
      <button id="close" aria-label="Đóng modal">✖</button>
    </div>
  </div>

  <section id="loichuc" data-aos="fade-up" aria-labelledby="loichuc-title">
    <h2 id="loichuc-title">Tường lời chúc</h2>
    <input type="text" id="searchInput" placeholder="Tìm kiếm lời chúc..." aria-label="Tìm kiếm lời chúc">
    <form id="msgForm" aria-label="Gửi lời chúc Quốc Khánh">
      <input type="text" id="nameInput" placeholder="Tên bạn..." required aria-label="Tên bạn">
      <input type="text" id="msgInput" placeholder="Viết lời chúc..." required aria-label="Lời chúc">
      <select id="emojiInput" aria-label="Chọn biểu tượng cảm xúc">
        <option value="🇻🇳">🇻🇳</option>
        <option value="❤️">❤️</option>
        <option value="🎉">🎉</option>
        <option value="🌟">🌟</option>
        <option value="🙏">🙏</option>
      </select>
      <button type="submit" aria-label="Gửi lời chúc">Gửi</button>
    </form>
    <div>
      <button id="exportBtn" aria-label="Xuất lời chúc">Xuất lời chúc</button>
      <select id="chartFilter" aria-label="Lọc biểu đồ lời chúc">
        <option value="day">Theo ngày</option>
        <option value="week">Theo tuần</option>
        <option value="month">Theo tháng</option>
      </select>
    </div>
    <canvas id="msgChart" aria-label="Biểu đồ số lượng lời chúc"></canvas>
    <div id="leaderboard" aria-label="Bảng xếp hạng người gửi lời chúc">
      <h3>Top 5 người gửi lời chúc</h3>
      <ol></ol>
    </div>
    <div id="wall" aria-label="Danh sách lời chúc"></div>
    <div class="pagination" aria-label="Phân trang lời chúc"></div>
  </section>

  <footer aria-label="Chân trang">
    <div class="marquee">🇻🇳 Tự hào dân tộc – Vững bước tương lai – Kỷ niệm 80 năm Quốc Khánh 2/9 🇻🇳</div>
    <div style="text-align:center; padding:12px; background:#f9f9f9; border:2px solid #ccc; border-radius:8px; max-width:95%; margin:12px auto;">
      <p style="font-size:15px; color:#d32f2f; font-weight:600; margin-bottom:10px;">
        ❤️ Yêu bác Hồ Chí Minh
      </p>
      <p style="font-size:12px; color:#555; margin-bottom:10px;">
        ⚠️ Lưu ý: Đây <strong>là phiên bản demo</strong> là website của TLGB TEAM
      </p>
      <p style="font-size:12px; color:#777;">
        💻 Thiết kế bởi <strong>Gia Bảo</strong> và <strong>TLGB TEAM</strong>
      </p>
    </div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.6/dist/purify.min.js"></script>
  <script src="https://messenger.svc.chative.io/static/v1.0/channels/s51de13cb-e497-4d27-8048-72589981d618/messenger.js?mode=livechat" defer="defer"></script>
  <script>
    // Initialize AOS with performance optimizations
    AOS.init({ duration: 500, once: true, disable: window.innerWidth < 600 });

    // Utilities
    const $ = (sel, ctx = document) => ctx.querySelector(sel);
    const $$ = (sel, ctx = document) => Array.from(ctx.querySelectorAll(sel));
    const debounce = (fn, ms) => {
      let timeout;
      return (...args) => {
        clearTimeout(timeout);
        timeout = setTimeout(() => fn(...args), ms);
      };
    };

    // Loading screen
    window.addEventListener('load', () => {
      setTimeout(() => {
        $('#loading-screen').classList.add('hidden');
        $('#loading-screen').setAttribute('aria-hidden', 'true');
      }, 600);
    });

    // Fireworks
    const canvas = $('#fireworks'), ctx = canvas.getContext('2d');
    let w, h, particles = [];
    function resize() { w = canvas.width = innerWidth; h = canvas.height = innerHeight; }
    window.addEventListener('resize', resize); resize();
    class Particle {
      constructor(x, y, color) {
        this.x = x;
        this.y = y;
        this.color = color;
        this.angle = Math.random() * 2 * Math.PI;
        this.speed = Math.random() * 1.5 + 0.5;
        this.life = 50;
      }
      update() {
        this.x += Math.cos(this.angle) * this.speed;
        this.y += Math.sin(this.angle) * this.speed + 0.2;
        this.life--;
      }
      draw() {
        ctx.beginPath();
        ctx.arc(this.x, this.y, 1, 0, 2 * Math.PI);
        ctx.fillStyle = this.color;
        ctx.fill();
      }
    }
    function boom(x = Math.random() * w, y = Math.random() * h / 2) {
      if (particles.length > 200) return;
      const color = `hsl(${Math.random() * 360}, 100%, 50%)`;
      for (let i = 0; i < 20; i++) particles.push(new Particle(x, y, color));
    }
    function loop() {
      ctx.fillStyle = 'rgba(0,0,0,0.08)';
      ctx.fillRect(0, 0, w, h);
      particles.forEach((p, i) => {
        p.update();
        p.draw();
        if (p.life <= 0) particles.splice(i, 1);
      });
      requestAnimationFrame(loop);
    }
    if (window.matchMedia('(prefers-reduced-motion: no-preference)').matches) loop();

    // Sticky nav
    const navLinks = $$('nav a');
    window.addEventListener('scroll', debounce(() => {
      let current = '';
      $$('section').forEach(section => {
        if (scrollY >= section.offsetTop - 50) current = section.id;
      });
      navLinks.forEach(link => {
        link.classList.toggle('active', link.getAttribute('href').slice(1) === current);
        link.setAttribute('aria-current', link.getAttribute('href').slice(1) === current ? 'page' : 'false');
      });
    }, 50));

    // Countdown
    function countdown() {
      const target = new Date('2025-09-02T00:00:00').getTime();
      const now = Date.now();
      const diff = target - now;
      const days = Math.floor(diff / (1000 * 60 * 60 * 24));
      const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
      const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
      const seconds = Math.floor((diff % (1000 * 60)) / 1000);
      $('#countdown').textContent = diff < 0 ? 'Chúc mừng Quốc Khánh 2/9/2025!' : `${days} ngày, ${hours} giờ, ${minutes} phút, ${seconds} giây`;
    }
    setInterval(countdown, 1000);

    // Message Wall
    const form = $('#msgForm'), searchInput = $('#searchInput'), wall = $('#wall'), pagination = $('.pagination'),
          exportBtn = $('#exportBtn'), chartFilter = $('#chartFilter'), leaderboard = $('#leaderboard ol'),
          clickSound = $('#clickSound');
    let msgs = JSON.parse(localStorage.getItem('msgs') || '[]');
    const messagesPerPage = 5;
    let currentPage = 1;

    function sanitizeInput(input) {
      return DOMPurify.sanitize(input, { ALLOWED_TAGS: [], ALLOWED_ATTR: [] });
    }

    function generateAvatar(name) {
      return name.charAt(0).toUpperCase();
    }

    function renderMessages(page = 1, filteredMsgs = msgs) {
      wall.innerHTML = '';
      const start = (page - 1) * messagesPerPage;
      const end = start + messagesPerPage;
      filteredMsgs.slice(start, end).forEach((m, i) => {
        const d = document.createElement('div');
        d.className = 'msg';
        d.innerHTML = `
          <div class="avatar" aria-hidden="true">${generateAvatar(m.name)}</div>
          <div class="content">
            <strong>${sanitizeInput(m.name)}</strong>: ${sanitizeInput(m.text)} ${m.emoji}
            <small>${m.time}</small>
            <button class="share-btn" aria-label="Chia sẻ lời chúc của ${sanitizeInput(m.name)}">Chia sẻ</button>
            <button class="like-btn${m.liked ? ' liked' : ''}" aria-label="Thích lời chúc của ${sanitizeInput(m.name)}">❤️ ${m.likes || 0}</button>
          </div>`;
        d.querySelector('.share-btn').onclick = () => shareMessage(m.name, m.text, m.emoji);
        d.querySelector('.like-btn').onclick = () => likeMessage(start + i);
        wall.appendChild(d);
      });
      renderPagination(filteredMsgs);
      updateLeaderboard();
    }

    function renderPagination(filteredMsgs) {
      pagination.innerHTML = '';
      const totalPages = Math.ceil(filteredMsgs.length / messagesPerPage);
      for (let i = 1; i <= totalPages; i++) {
        const btn = document.createElement('button');
        btn.textContent = i;
        btn.setAttribute('aria-label', `Trang ${i}`);
        btn.className = i === currentPage ? 'active' : '';
        btn.onclick = () => {
          currentPage = i;
          renderMessages(i, filteredMsgs);
          $$('.pagination button').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          clickSound.play().catch(() => {});
        };
        pagination.appendChild(btn);
      }
    }

    function likeMessage(index) {
      msgs[index].likes = (msgs[index].likes || 0) + 1;
      msgs[index].liked = true;
      localStorage.setItem('msgs', JSON.stringify(msgs));
      renderMessages(currentPage);
      clickSound.play().catch(() => {});
    }

    function updateLeaderboard() {
      const nameCounts = {};
      msgs.forEach(m => nameCounts[m.name] = (nameCounts[m.name] || 0) + 1);
      leaderboard.innerHTML = Object.entries(nameCounts).sort((a, b) => b[1] - a[1]).slice(0, 5)
        .map(([name, count]) => `<li>${sanitizeInput(name)}: ${count} lời chúc</li>`).join('');
    }

    form.onsubmit = e => {
      e.preventDefault();
      const name = sanitizeInput($('#nameInput').value.trim());
      const message = sanitizeInput($('#msgInput').value.trim());
      if (!name || name.length > 50) return alert('Tên phải từ 1-50 ký tự!');
      if (!message || message.length > 200) return alert('Lời chúc phải từ 1-200 ký tự!');
      const now = new Date();
      if (!localStorage.getItem('lastMsgTime') || (now.getTime() - parseInt(localStorage.getItem('lastMsgTime'))) > 60000) {
        msgs.unshift({
          name, text: message, emoji: $('#emojiInput').value,
          time: now.toLocaleString('vi-VN'), date: now.toISOString().split('T')[0],
          week: Math.floor(now.getTime() / (1000 * 60 * 60 * 24 * 7)), month: now.getMonth() + 1,
          likes: 0, liked: false
        });
        localStorage.setItem('msgs', JSON.stringify(msgs));
        localStorage.setItem('lastMsgTime', now.getTime());
        $('#nameInput').value = '';
        $('#msgInput').value = '';
        renderMessages(currentPage);
        updateChart();
        boom(innerWidth / 2, innerHeight / 2);
        clickSound.play().catch(() => {});
      } else {
        alert('Vui lòng đợi 1 phút trước khi gửi tiếp!');
      }
    };

    searchInput.addEventListener('input', debounce(() => {
      const query = sanitizeInput(searchInput.value.toLowerCase());
      const filteredMsgs = msgs.filter(m => m.name.toLowerCase().includes(query) || m.text.toLowerCase().includes(query));
      currentPage = 1;
      renderMessages(1, filteredMsgs);
    }, 300));

    exportBtn.onclick = () => {
      const text = msgs.map(m => `${sanitizeInput(m.name)}: ${sanitizeInput(m.text)} ${m.emoji} (${m.time})`).join('\n');
      const blob = new Blob([text], { type: 'text/plain' });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = 'loi-chuc-2-9.txt';
      a.click();
      URL.revokeObjectURL(blob);
      clickSound.play().catch(() => {});
    };

    function shareMessage(name, text, emoji) {
      const shareText = `${name}: ${text} ${emoji}`;
      if (navigator.share) {
        navigator.share({ title: 'Lời chúc Quốc Khánh 2/9', text: shareText, url: window.location.href })
          .catch(() => alert('Chia sẻ: ' + shareText));
      } else {
        window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(shareText)}&url=${encodeURIComponent(window.location.href)}`, '_blank');
      }
      clickSound.play().catch(() => {});
    }

    const chart = new Chart($('#msgChart'), {
      type: 'bar',
      data: { labels: [], datasets: [{ label: 'Số lời chúc', data: [], backgroundColor: 'rgba(255,204,0,0.6)', borderColor: 'rgba(255,204,0,1)', borderWidth: 1 }] },
      options: { scales: { y: { beginAtZero: true, ticks: { stepSize: 1 } } }, plugins: { legend: { display: true } } }
    });

    function updateChart(filter = 'day') {
      const counts = {};
      if (filter === 'day') {
        msgs.forEach(m => counts[m.date] = (counts[m.date] || 0) + 1);
        chart.data.labels = Object.keys(counts).sort();
        chart.data.datasets[0].label = 'Số lời chúc theo ngày';
      } else if (filter === 'week') {
        msgs.forEach(m => counts[m.week] = (counts[m.week] || 0) + 1);
        chart.data.labels = Object.keys(counts).map(w => `Tuần ${w}`);
        chart.data.datasets[0].label = 'Số lời chúc theo tuần';
      } else {
        msgs.forEach(m => counts[m.month] = (counts[m.month] || 0) + 1);
        chart.data.labels = Object.keys(counts).map(m => `Tháng ${m}`);
        chart.data.datasets[0].label = 'Số lời chúc theo tháng';
      }
      chart.data.datasets[0].data = Object.values(counts);
      chart.update();
    }

    chartFilter.onchange = () => updateChart(chartFilter.value);
    renderMessages();
    updateChart();

    const anthem = $('#anthem'), musicControl = $('#musicControl'), musicSelect = $('#musicSelect');
    let playing = false;
    musicControl.onclick = () => {
      if (!playing) {
        anthem.play().catch(() => alert('Không thể phát nhạc!'));
        musicControl.textContent = '⏸️';
        musicControl.setAttribute('aria-label', 'Dừng nhạc nền');
        playing = true;
      } else {
        anthem.pause();
        musicControl.textContent = '🔊';
        musicControl.setAttribute('aria-label', 'Phát nhạc nền');
        playing = false;
      }
      clickSound.play().catch(() => {});
    };
    musicSelect.onchange = () => {
      anthem.src = musicSelect.value;
      if (playing) anthem.play().catch(() => alert('Không thể phát nhạc!'));
      clickSound.play().catch(() => {});
    };
    anthem.src = musicSelect.value;

    const modal = $('#modal'), modalImg = modal.querySelector('img'), modalCaption = modal.querySelector('figcaption'),
          gallery = $$('.gallery img');
    let current = 0;
    function showModal(i) {
      current = i;
      modalImg.src = gallery[i].dataset.src || gallery[i].src;
      modalCaption.textContent = gallery[i].nextElementSibling.textContent;
      modal.style.display = 'flex';
      modal.classList.add('show');
      modal.focus();
      clickSound.play().catch(() => {});
    }
    gallery.forEach((img, i) => img.onclick = () => showModal(i));
    $('#prev').onclick = () => showModal((current - 1 + gallery.length) % gallery.length);
    $('#next').onclick = () => showModal((current + 1) % gallery.length);
    $('#close').onclick = () => {
      modal.style.display = 'none';
      modal.classList.remove('show');
      clearInterval(slideshowInterval);
      clickSound.play().catch(() => {});
    };
    let slideshowInterval;
    modal.addEventListener('click', () => {
      clearInterval(slideshowInterval);
      slideshowInterval = setInterval(() => showModal((current + 1) % gallery.length), 4000);
    });
    modal.addEventListener('keydown', e => {
      if (modal.style.display === 'none') return;
      if (e.key === 'ArrowLeft') showModal((current - 1 + gallery.length) % gallery.length);
      else if (e.key === 'ArrowRight') showModal((current + 1) % gallery.length);
      else if (e.key === 'Escape') {
        modal.style.display = 'none';
        modal.classList.remove('show');
        clearInterval(slideshowInterval);
        clickSound.play().catch(() => {});
      }
    });

    $$('.gallery-filter button').forEach(button => {
      button.addEventListener('click', () => {
        $$('.gallery-filter button').forEach(btn => {
          btn.classList.remove('active');
          btn.setAttribute('aria-selected', 'false');
        });
        button.classList.add('active');
        button.setAttribute('aria-selected', 'true');
        const filter = button.getAttribute('data-filter');
        $$('.gallery figure').forEach(item => {
          item.style.display = filter === 'all' || item.dataset.category === filter ? 'block' : 'none';
        });
        clickSound.play().catch(() => {});
      });
    });

    const scrollTopBtn = $('#scrollTop');
    window.addEventListener('scroll', debounce(() => {
      scrollTopBtn.style.display = window.scrollY > 200 ? 'block' : 'none';
    }, 50));
    scrollTopBtn.onclick = () => {
      window.scrollTo({ top: 0, behavior: 'smooth' });
      clickSound.play().catch(() => {});
    };

    const themeToggle = $('#themeToggle');
    themeToggle.onclick = () => {
      document.body.classList.toggle('light-mode');
      themeToggle.textContent = document.body.classList.contains('light-mode') ? '🌙' : '☀️';
      themeToggle.setAttribute('aria-label', document.body.classList.contains('light-mode') ? 'Chuyển đổi chế độ tối' : 'Chuyển đổi chế độ sáng');
      localStorage.setItem('theme', document.body.classList.contains('light-mode') ? 'light' : 'dark');
      clickSound.play().catch(() => {});
    };
    if (localStorage.getItem('theme') === 'light') {
      document.body.classList.add('light-mode');
      themeToggle.textContent = '🌙';
      themeToggle.setAttribute('aria-label', 'Chuyển đổi chế độ tối');
    }

    $$('section').forEach(section => {
      section.addEventListener('click', e => {
        const rect = section.getBoundingClientRect();
        boom(e.clientX, e.clientY - rect.top);
      });
    });

    const images = $$('img[data-src]');
    const observer = new IntersectionObserver((entries, obs) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          const img = entry.target;
          img.src = img.dataset.src;
          img.removeAttribute('data-src');
          obs.unobserve(img);
        }
      });
    }, { rootMargin: '0px 0px 100px 0px' });
    images.forEach(img => observer.observe(img));
  </script>
  <script>
    // Import the functions you need from the SDKs you need
import { initializeApp } from "firebase/app";
import { getAnalytics } from "firebase/analytics";
// TODO: Add SDKs for Firebase products that you want to use
// https://firebase.google.com/docs/web/setup#available-libraries

// Your web app's Firebase configuration
// For Firebase JS SDK v7.20.0 and later, measurementId is optional
const firebaseConfig = {
  apiKey: "AIzaSyBwgEi22AOC0N9vU6IHknwRVSXTqqcRw84",
  authDomain: "binhluan-6e96e.firebaseapp.com",
  projectId: "binhluan-6e96e",
  storageBucket: "binhluan-6e96e.firebasestorage.app",
  messagingSenderId: "346464020974",
  appId: "1:346464020974:web:24015111a9b9c3701fc6ff",
  measurementId: "G-CT6CCYHSB6"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const analytics = getAnalytics(app);
  </script>
</body>
</html>
